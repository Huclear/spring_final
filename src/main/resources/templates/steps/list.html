<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Steps</title>
    <script>
        window.onload = function() {
            var errorMessage = document.getElementById('errorMessage');
            if (errorMessage && errorMessage.textContent.trim() !== '') {
                alert(errorMessage.textContent);
            }
        };
    </script>
</head>
<body>
<h3 id="errorMessage" th:text="${error_message}" style="display:none;"></h3>
<h1>Steps list</h1>
<a th:href="@{/steps/add}">Add step</a>
<form action="/steps" method="get">
    <label>
        Total time from:
        <input type="number" min="0" name="time_from" th:value="${time_from}">
    </label>
    <label>
        Total time to:
        <input type="number" min="0" name="time_to" th:value="${time_to}">
    </label>
    <br>
    <label>
        From order:
        <input type="number" min="0" name="from_order" th:value="${from_order}">
    </label>
    <label>
        Until order:
        <input type="number" min="0" name="to_order" th:value="${to_order}">
    </label>
    <br>
    <label>
        Recipe:
        <select name="recipe_id" th:value="${recipe_id}" required>
            <option th:each="recipe : ${allowed_recipes}"
                    th:value="${recipe.id}"
                    th:text="${recipe.recipe_name} + ' - ' + ${recipe.recipe_description}"></option>
        </select>
    </label>
    <br>

    <label>
        Page:
        <input type="number" name="page" th:value="${steps.currentPage}">
    </label>
    <label>
        Page size:
        <input type="number" name="perPage" th:value="${steps.pageSize}" min="10">
    </label>
    <button type="submit">Search</button>
</form>
<br>
<br>
<ul>
    <h2>Steps:</h2>
    <th:block th:each="step : ${steps.value}">
        <li>
            <p th:text="'Step ' + ${step.step_order}"></p>
            <span th:text="'Duration: ' + ${step.durationMinutes} + ' minutes'"></span>
            <span th:text="'Description:' + ${step.description}"></span>
            <label>
                Recipe:
                <span th:text="${step.recipe.id} + ' - ' + ${step.recipe.recipe_name}"></span>
            </label>

            <a th:href="@{/steps/edit/{id}(id=${step.id})}">Edit step</a>
            <a th:href="@{/steps/delete/{id}(id=${step.id})}"
               onclick="return confirm('Вы уверены, что хотите удалить?');">Delete step</a>
        </li>
    </th:block>
</ul>
</body>
</html>