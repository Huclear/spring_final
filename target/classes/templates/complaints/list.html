<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Complaints</title>
    <script>
        window.onload = function() {
            var errorMessage = document.getElementById('errorMessage');
            if (errorMessage && errorMessage.textContent.trim() !== '') {
                alert(errorMessage.textContent);
            }
        };
    </script>
</head>
<body>
<h3 id="errorMessage" th:text="${error_message}" style="display:none;"></h3>
<h1>Complaints list</h1>
<a th:href="@{/complaints/add}">Add Complaint</a>
<form action="/complaints" method="get">
    <label>
        User:
        <select name="user" th:value="${user}">
            <option value="">None</option>
            <option th:each="option : ${allowed_users}"
                    th:value="${option.id}"
                    th:text="${option.id} + ' - ' + ${option.login} + ' - ' + ${option.nickname}"></option>

        </select>
    </label>

    <br>
    <label>
        Recipe:
        <select name="recipe" th:value="${recipe}">
            <option value="">None</option>
            <option th:each="option : ${allowed_recipes}"
                    th:value="${option.id}"
                    th:text="${option.id} + ' - ' + ${option.recipe_name}"></option>
        </select>
    </label>

    <br>
    <label>
        Status:
        <select name="status" th:value="${status}">
            <option value="">None</option>
            <option th:each="option : ${statuses}"
                    th:value="${option}"
                    th:text="${option.name}"></option>
        </select>
    </label>

    <br>
    <label>
        Topic:
        <input type="text" name="topic" th:value="${topic}">
    </label>

    <br>
    <label>
        Page:
        <input type="number" name="page" th:value="${complaints.currentPage}">
    </label>
    <label>
        Page size:
        <input type="number" name="perPage" th:value="${complaints.pageSize}" min="10">
    </label>
    <button type="submit">Search</button>
</form>
<br>
<br>
<ul>
    <h2>Reviews:</h2>
    <th:block th:each="complaint : ${complaints.value}">
        <li>
            <span th:if="${complaint.recipe != null}"
                  th:text="'Recipe - ' + ${complaint.recipe.id} + ' - ' + ${complaint.recipe.recipe_name}"></span>
            <span th:if="${complaint.user != null}"
                    th:text="'User - ' + ${complaint.user.id} + ' - ' + ${complaint.user.login} + ' - ' + ${complaint.user.nickname}"></span>

            <span th:text="'Topic - ' + ${complaint.topic}"></span>
            <span th:text="'Description - ' + ${complaint.description}"></span>
            <span th:text="'Status - ' + ${complaint.status}"></span>

            <a th:href="@{/complaints/edit/{id}(id=${complaint.id})}">Edit complaint</a>
            <a th:href="@{/complaints/delete/{id}(id=${complaint.id})}"
               onclick="return confirm('Вы уверены, что хотите удалить?');">Delete Complaint</a>
        </li>
    </th:block>
</ul>
</body>
</html>